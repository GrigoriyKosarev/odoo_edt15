# ============================================
# Dockerfile для Odoo 15
# ============================================
#
# Що таке Dockerfile?
# -------------------
# Це "рецепт" для створення Docker образу.
# Кожна інструкція (FROM, RUN, COPY...) створює новий "шар" образу.
#
# Як використовувати:
# -------------------
# docker build -t my-odoo15 .
# docker run -p 8069:8069 my-odoo15
#

# ============================================
# FROM - базовий образ
# ============================================
# Беремо офіційний образ Odoo 15 з Docker Hub
# Це як "батьківський клас" - наслідуємо всі його файли та налаштування
FROM odoo:15

# ============================================
# LABEL - метадані образу
# ============================================
# Інформація про образ (автор, версія, опис)
# Не впливає на роботу, але корисно для документації
LABEL maintainer="your-email@example.com"
LABEL version="1.0"
LABEL description="Odoo 15 for development"

# ============================================
# USER root - переключення на root користувача
# ============================================
# Офіційний образ Odoo працює під користувачем 'odoo'
# Для встановлення пакетів потрібні права root
USER root

# ============================================
# RUN - виконання команд при збірці образу
# ============================================
# Оновлюємо список пакетів та встановлюємо додаткові утиліти
# && - виконати наступну команду якщо попередня успішна
# \ - перенос рядка для читабельності
# --no-install-recommends - не встановлювати рекомендовані пакети (економить місце)
# rm -rf /var/lib/apt/lists/* - очищаємо кеш apt (зменшує розмір образу)
RUN apt-get update && apt-get install -y --no-install-recommends \
    # Для роботи з Git (корисно для розробки)
    git \
    # Текстовий редактор (для налагодження в контейнері)
    nano \
    # Мережеві утиліти (ping, etc.)
    iputils-ping \
    # Очищаємо кеш
    && rm -rf /var/lib/apt/lists/*

# ============================================
# Встановлення додаткових Python пакетів
# ============================================
# pip3 install - менеджер пакетів Python
# --no-cache-dir - не кешувати завантажені пакети (зменшує розмір)
RUN pip3 install --no-cache-dir \
    # Для дебагу Python коду
    debugpy \
    # Покращений REPL для Python
    ipython \
    # Для роботи з Excel файлами (часто потрібно в Odoo)
    xlrd \
    xlwt \
    openpyxl

# ============================================
# COPY - копіювання файлів в образ
# ============================================
# Копіюємо конфігурацію Odoo
# Формат: COPY <джерело на хості> <призначення в контейнері>
COPY ./odoo.conf /etc/odoo/odoo.conf

# ============================================
# USER odoo - повертаємось до користувача odoo
# ============================================
# Запускати Odoo під root небезпечно
# Повертаємось до непривілейованого користувача
USER odoo

# ============================================
# EXPOSE - документуємо порти
# ============================================
# Це НЕ відкриває порти! Лише документує які порти використовує додаток
# Реальне відкриття портів робиться через -p або ports: в docker-compose
EXPOSE 8069
EXPOSE 8072

# ============================================
# CMD - команда за замовчуванням
# ============================================
# Що запускати коли контейнер стартує
# Можна перевизначити в docker-compose.yml або через docker run
CMD ["odoo", "-c", "/etc/odoo/odoo.conf"]
